---
title: "Rbootcamp"
author: "Michael Kleinsasser"
date: "8/8/2019"
output: 
    beamer_presentation:
      theme: "CambridgeUS"
      colortheme: "dolphin"
      fonttheme: "structurebold"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


## Mike's Personal Introduction

\begin{columns}[T] % align columns
\begin{column}{.48\textwidth}

\begin{itemize}
\setlength\itemsep{1em}

\item R programmer for the Department of Biostatistics

\item Write and mantain R packages for faculty and students

\item Consult faculty and students on writing R packages

\end{itemize}


\end{column}%
\hfill%
\begin{column}{.48\textwidth}

\includegraphics[width = 2in]{personal_picture.jpg}

\end{column}%
\end{columns}

## Rbootcamp Introduction

Goals:

- R basics: syntax, common functions, etc., via Rstudio
- R functions and for loops (functions and advanced control structures)
- Basics of R on the cluster (non-interactive R using BATCH scripts)
- Simulation analysis with comment on efficiency

## Materials

- All bootcamp materials online at https://github.com/umich-biostatistcs/Rbootcamp

- Handouts for each topic with examples to work through

- R scripts of our examples

## Setup

Go to Rstudio cloud to follow along:

- Enter username, etc. for free account

- Follow along by typing commands in my slides

- If you have Rstudio/R, open that

- Recommended: Install R/Rstudio for days 2, 3

## R Basics: Big Picture

 - R is a sophisticated calculator for statistics

Chambers (2016) Extending R:

 - Everything that exists in R is an object
 - Everything that happens in R is a function call
 
Obtain a basic working knowledge of R objects and functions, 

 - Google the rest

## R Basics: Goals

- Data types and functions
\smallskip 
  - Create object having data types
  - Combine those into data structures
  - Write basic R function

\medskip

- Learn parts of R most useful to statisticians
\smallskip 
  - How do most modeling functions work in R, and
  - How to inspect structure and content of objects
  
  
## Use R as a calculator

Standard operations: 

```{r , echo = TRUE}
# multiply *, divide /, add + subtract
18056.983 - 1005.118 + 22.53

( (pi - 3.14) / (3.14) )  * 100
```

\includegraphics[width = 2in]{calculator.JPG}

## Assignment in R

```{r asignment, echo = TRUE}
# x gets the number 3.14
x <- 3.14

x     # print x

# equivalently
x = 3.14

x     # print x
```

## R data types/structures

Five fundamental data types

- character, numeric, integer, logical, complex
NOTE: insert table/picture of functions with examples

Combine to form data structures

- atomic vector (atomic - vector of single type)
- list
- matrix
- data.frame
- factor

## R data types/structures

Five fundamental data types

- character, numeric, integer, logical, complex
NOTE: insert table/picture of functions with information

## R data types/structures

Combine to form data structures

- atomic vector (atomic - vector of single type)
- list
- matrix
- data.frame
- factor
NOTE: insert table/picture of functions with information

## Data types examples

3 ways to create numeric vector:

```{r , echo = TRUE}
# empty numeric vector
y1 <- numeric(6)
y1     # print y1

y2 <- vector(mode = "numeric", length = 6)
y2     # print y2

y3 <- c(5, 13.222, 2, 0.001, 77.4, 31.9)
y3     # print y3
```


## Data structures examples

\small Create a data.frame out of the following "class" data:

- \small Has Master's (logical):  TRUE FALSE FALSE TRUE
- \small GPA (numeric):           3.1  4.0   2.9   3.6
- \small First Name (character):  Mike Dan   Sara  Karen

```{r , echo = TRUE}
# store data
has_ms <- c(TRUE, FALSE, FALSE, TRUE)
gpa <- c(3.1, 4.0, 2.9, 3.6)
name <- c("Mike", "Dan", "Sara", "Karen")
# Create data.frame
dat <- data.frame(has_MS = has_ms, GPA = gpa, Name = name)
dat    # print data.frame
```

## Inspect an object

- Class() - what kind of object is it (high-level)?
- typeof() - what is the data type (low-level)?
- length() - how long is it?
- attributes() - does it have meta-data?

## R functions

\small R function syntax:

\small NAME <- function(ARG1, ARG2, ARG3) { \newline
\small \hspace*{20pt} DO SOMETHING \newline
\small \hspace*{20pt} STORE RESULT \newline
\small \hspace*{20pt} return(RESULT) \newline
\small }

```{r , echo = TRUE}
pow <- function(base, expon) { # power function
  prod(rep(base, expon)) # base^(expon)
}
# Use power function
pow(5, 2)
pow(10, 3)
```

## Common R functions

\small R has a huge collection of packages:

\small  - 6,000+ packages for data analysis build (on CRAN alone)

\small Example: lm (linear models)

\small - Use ?lm to read help documentation 

\includegraphics[width = 3in]{lm_help.PNG}

## Fit a linear model with lm

- Use built-in data set ToothGrowth

- ?ToothGrowth for help:

\includegraphics[width = 3in]{quesToothGrowth.JPG}

## View the data

\small View data in new window:
```{r, echo = TRUE,eval=FALSE}
View(ToothGrowth)
```

\small Or use head to view only first 6 rows:
\tiny
```{r, echo = TRUE}
head(ToothGrowth)
```

\small How big is the data?
\tiny
```{r, echo = TRUE}
dim(ToothGrowth)
```


## Using lm() function for linear models
Call lm on the data and formula, store result "lm" object:
```{r, echo = TRUE, eval = TRUE}
tooth_fit = lm(formula = len ~ supp + dose, 
               data = ToothGrowth)
```

Formulas in R:
```{r, echo = TRUE, eval = FALSE}
len ~      # Response column name, ~ for "="
  supp +   # First predictor name + for "+"
  dose     # second predictor name
```

Many R functions use the formula argument.

## Getting detailed information

\small
Basic "print" of model:
\tiny
```{r, echo = TRUE, eval = TRUE}
print(tooth_fit)     # equivalent to tooth_fit
```
\small
Detailed summary:
\tiny
```{r, echo = TRUE, eval = TRUE}
summary(tooth_fit)
```

## Understanding R classes

- What is this thing?
```{r, echo = TRUE, eval = FALSE}
class(tooth_fit)
```
- What are the methods for this object?
```{r, echo = TRUE, eval = FALSE}
methods(class = "lm")
```
- What is its structure? (i.e., what's in it)
```{r, echo = TRUE, eval = FALSE}
str(tooth_fit)
```

## Understanding R classes

- What is this thing?
```{r, echo = TRUE, eval = TRUE}
class(tooth_fit)
```

## Understanding R classes
\small
- What are the methods for this object?
```{r, echo = TRUE, eval = TRUE}
methods(class = "lm")
```

## Understanding R classes

\tiny
- What is its structure? (i.e., what's in it)
```{r, echo = TRUE, eval = TRUE}
str(tooth_fit)
```

## Understanding R classes

- Pull something out of the "lm" fit object:

\tiny
```{r, echo = TRUE, eval = TRUE}
tooth_fit$fitted.values        # y_hat's for the linear model
```

## Extracting data from model objects

Some generic extraction methods: 

```{r, echo = TRUE, eval = FALSE}
coef(tooth_fit)            # model coefficients

coef(summary(tooth_fit))   # adds test statistics, p-values

vcov(tooth_fit)            # variance/covariance matrix
```

Note: depending on implementation, these may not be available
- Check methods with "methods(object)" before attempting

## Extracting data from model objects (in detail)

Extract coefficients, test stats, and p-values
```{r, echo = TRUE, eval = TRUE}
coef(summary(tooth_fit))   # adds test statistics, p-values
```


## Predict new values

- predict() function is generic and works with many models

- Pass in a new data.frame with the same column names:

```{r, echo = TRUE, eval = TRUE}
to_predict = data.frame(dose = 0.5, supp = "VC")
```

```{r, echo = TRUE, eval = TRUE}
predict(tooth_fit, newdata = to_predict)
```


## Predict new values (example 2)

- predict() function is generic and works with many models

- Pass in a new data.frame with the same column names:

\small
```{r, echo = TRUE, eval = TRUE}
to_predict = data.frame(dose = seq(0,1,0.1), supp = "OJ")
```

```{r, echo = TRUE, eval = TRUE}
predict(tooth_fit, newdata = to_predict)
```


## R on cluster (non-interactive R)

\textbf{Cluster Computation}

- Dan Barker danbarke at umich.edu

\medskip

- Cluster System Administrator


## R workflow for statistical analysis

\begin{columns}[T] % align columns
\begin{column}{.36\textwidth}

\begin{itemize}
\setlength\itemsep{1em}

\item Bootcamps throughout semester on each area


\end{itemize}


\end{column}%
\hfill%
\begin{column}{.62\textwidth}

\includegraphics[width = 3in]{analysis_in_r2.png}

\end{column}%
\end{columns}

## Advanced control structures

Common misconception: "loops in R are slow"

Explain

## Loops: often not necessary

 - Many R functions are "vectorized" (vector in, vector out)

 - While most other languages require loops, R does not:
 
```{r, echo = TRUE, eval = TRUE}
a = c(5, 2, 4, 12, 1)
b = c(2, 0, 3, -1, 2)

a + b     # vector + vector = vector
```

Takehome: When possible, operate on vectors and matrices, don't loop over each 
row/position index

## Problem: not all functions are vectorized

- Some functions, like read.table() for reading a table of data into R, are 
not vectorized

- But what if we have a list of files to read in? "data1.txt", "data2.txt",
"data3.txt", ..., "data50.txt"



## Simulation

## Simulate lm 

Need to come up with some question to answer.

## Bootstrap lm results



## Useful R packages

- ggplot2 - Best package for plotting data
  - getting started: 

- dplyr - Best package for manipulating/processing data
  - getting started:
  
  
## Future bootcamps 

- dplyr: date ____

- ggplot2: date ____
